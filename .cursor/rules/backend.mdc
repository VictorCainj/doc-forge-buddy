---
description: Regras para comunica√ß√£o com o backend Supabase.
---

# üõ† Supabase Backend

## Configura√ß√£o
- **Vari√°veis de ambiente obrigat√≥rias**:
  - `VITE_SUPABASE_URL` - URL do projeto Supabase
  - `VITE_SUPABASE_PUBLISHABLE_KEY` - Chave p√∫blica do Supabase
- Cliente tipado em `src/integrations/supabase/client.ts`
- Types gerados automaticamente em `src/integrations/supabase/types.ts`

## Padr√µes de Comunica√ß√£o
- Usar **hooks customizados** para opera√ß√µes espec√≠ficas (`useContracts()`, `useVistoria()`)
- Consultas tipadas com `Database` types do Supabase
- Sempre usar `.throwOnError()` ou `try/catch` para tratamento de erros
- Evitar chamadas diretas - preferir abstra√ß√µes em hooks/services

## Supabase Storage
- **Buckets utilizados**: `vistorias`, `documentos`, `contratos`
- **Padr√£o de nomea√ß√£o**: `${userId}_${tipo}_${timestamp}.${extensao}`
- **Pol√≠ticas RLS** configuradas para acesso baseado em usu√°rio
- Upload via `supabase.storage.from(bucket).upload()`

## Migrations Dispon√≠veis
- `20241220000000_add_notificacao_rescisao_to_existing_contracts.sql`
- `20250115000000_optimize_rls_policies.sql` (29 pol√≠ticas otimizadas)

## Edge Functions
- `openai-proxy` - Integra√ß√£o com OpenAI API
- `upscale-image` - Otimiza√ß√£o de imagens
- Chamadas via `supabase.functions.invoke('function-name')`

## Seguran√ßa
- **Nunca expor chaves sens√≠veis** no frontend
- Usar RLS (Row Level Security) em todas as tabelas
- Valida√ß√£o de dados com Zod antes de inserir/atualizar
- Logs de auditoria para opera√ß√µes cr√≠ticas
